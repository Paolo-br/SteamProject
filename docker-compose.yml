# docker-compose.yml - Stack complète Steam Project
# Orchestration : Frontend UI + Backend + Kafka + Postgres (si nécessaire)

version: '3.8'

services:
  # ========================================
  # Frontend (Compose Desktop UI)
  # ========================================
  # NOTE : Compose Desktop nécessite affichage graphique
  # Sur Windows, recommandé de lancer en natif (pas dans Docker)
  # Cette définition est pour référence / CI/CD Linux

  # frontend:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: steam-frontend
  #   environment:
  #     - DISPLAY=${DISPLAY}  # X11 forwarding (Linux/Mac)
  #     - BACKEND_URL=http://backend:8080
  #     - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
  #   volumes:
  #     - /tmp/.X11-unix:/tmp/.X11-unix  # X11 socket (Linux)
  #     - ./src:/app/src  # Hot reload (dev mode)
  #   depends_on:
  #     - backend
  #     - kafka
  #   networks:
  #     - steam-network

  # ========================================
  # Backend REST API (à implémenter par collègue)
  # ========================================
  # Décommenter quand le backend est prêt

  # backend:
  #   image: steam-backend:latest  # À remplacer par l'image du collègue
  #   container_name: steam-backend
  #   ports:
  #     - "8080:8080"
  #   environment:
  #     - SPRING_PROFILES_ACTIVE=docker
  #     - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
  #     - DATABASE_URL=jdbc:postgresql://postgres:5432/steamdb
  #   depends_on:
  #     - postgres
  #     - kafka
  #   networks:
  #     - steam-network

  # ========================================
  # Kafka (événements temps réel)
  # ========================================
  zookeeper:
    image: confluentinc/cp-zookeeper:7.5.0
    container_name: steam-zookeeper
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    networks:
      - steam-network

  kafka:
    image: confluentinc/cp-kafka:7.5.0
    container_name: steam-kafka
    ports:
      - "9092:9092"
      - "29092:29092"
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "true"
    depends_on:
      - zookeeper
    networks:
      - steam-network

  # ========================================
  # PostgreSQL (si nécessaire pour backend)
  # ========================================
  # postgres:
  #   image: postgres:15-alpine
  #   container_name: steam-postgres
  #   ports:
  #     - "5432:5432"
  #   environment:
  #     POSTGRES_DB: steamdb
  #     POSTGRES_USER: steam
  #     POSTGRES_PASSWORD: steam_password_change_me
  #   volumes:
  #     - postgres-data:/var/lib/postgresql/data
  #   networks:
  #     - steam-network

networks:
  steam-network:
    driver: bridge

volumes:
  postgres-data:

